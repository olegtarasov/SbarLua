# Repository Guidelines

## Project Structure & Module Organization
- `src/`: C99 sources for the SketchyBar Lua module (`sketchybar.c`, parsing helpers, Mach IPC glue, bundled `cJSON`).
- `lua-5.4.7/`: Vendored Lua used to build `bin/liblua.a`; built automatically by `make`.
- `example/`: Complete SketchyBar config in Lua (`init.lua`, items, colors, icons, `sketchybarrc`) for local testing or as a starting point.
- `bin/`: Build outputs (`sketchybar.so`, `liblua.a`); generated by `make` and safe to delete.
- Root files: `makefile`, `README.md`, `LICENSE`; keep edits here minimal and documented.

## Build, Test, and Development Commands
- `make bin/sketchybar.so` – Compile the module and vendored Lua (requires clang, macOS arm64/x86_64).
- `make install` – Build and install `sketchybar.so` into `$HOME/.local/share/sketchybar_lua/`.
- `make clean` – Remove build artifacts and reset the vendored Lua tree.
- Quick manual run: `sketchybar --config example/sketchybarrc` after ensuring `package.cpath` includes `$HOME/.local/share/sketchybar_lua/?.so`.

## Coding Style & Naming Conventions
- C: C99, 2-space indent, `snake_case` for functions/variables, `ALL_CAPS` macros; prefer `static` helpers within a TU.
- Lua: Mirror SketchyBar property names, keep identifiers lowercase with underscores, and scope state via `local`.
- Avoid blocking calls in Lua; favor `sbar.exec(<cmd>, <callback>)` instead of `os.execute`/`io.popen`.

## Testing Guidelines
- No automated tests yet; validate changes by rebuilding and running the `example/` config, watching for `[i] sketchybar:` logs.
- Smoke check the install:  
  `lua -e "package.cpath = package.cpath .. ';$HOME/.local/share/sketchybar_lua/?.so'; require('sketchybar')"`.
- When modifying parsing or IPC, add/adjust an item in `example/` to exercise the new behavior and confirm events fire.

## Commit & Pull Request Guidelines
- Commits are short, imperative summaries (e.g., `save state on module load`); keep scope focused.
- PRs should call out behavior changes, tested platform, manual verification steps, and any Lua API additions; link issues when applicable.
- Include logs or screenshots when altering the example configuration’s visible output.
